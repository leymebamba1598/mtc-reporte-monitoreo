<p-toast></p-toast>
<p-table styleClass="gridlines" [value]="products" dataKey="id" [tableStyle]="{ 'min-width': '60rem' }" [expandedRowKeys]="expandedRows" (onRowExpand)="onRowExpand($event)" (onRowCollapse)="onRowCollapse($event)">
	<ng-template #caption>
		<div class="flex flex-wrap justify-end gap-2">
			<p-button label="Expand All" icon="pi pi-plus" text (onClick)="expandAll()"></p-button>
			<p-button label="Collapse All" icon="pi pi-minus" text (onClick)="collapseAll()"></p-button>
		</div>
	</ng-template>
	<ng-template #header>
		<tr>
			<th rowspan="2" style="width: 1rem"></th>
			<th rowspan="2">Name</th>
			<th colspan="2" class="text-center">Enero</th>
			<th colspan="2" class="text-center">Febrero</th>
			<th colspan="2" class="text-center">Marzo</th>
		</tr>
		<tr>
			<th>Cantidad</th>
			<th>Valor</th>
			<th>Cantidad</th>
			<th>Valor</th>
			<th>Cantidad</th>
			<th>Valor</th>
		</tr>
	</ng-template>
	<ng-template #body let-product let-expanded="expanded">
		<tr>
			<td>
				<p-button type="button" pRipple [pRowToggler]="product" text="true"  [rounded]="true" [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></p-button>
			</td>
			<td>{{ product.name }}</td>
			<td>{{ product.enero?.cantidad || 0 }}</td>
			<td>{{ (product.enero?.valor || 0) | currency : 'USD' }}</td>
			<td>{{ product.febrero?.cantidad || 0 }}</td>
			<td>{{ (product.febrero?.valor || 0) | currency : 'USD' }}</td>
			<td>{{ product.marzo?.cantidad || 0 }}</td>
			<td>{{ (product.marzo?.valor || 0) | currency : 'USD' }}</td>
		</tr>
	</ng-template>
	<ng-template #expandedrow let-product>
		<tr>
			<td colspan="8">
				<div class="p-4">
					<h5>Lista de proyectos de {{ product.name }}</h5>
					<p-table styleClass="gridlines" [value]="product.orders" dataKey="id">
						<ng-template #header>
							<tr>
								<th rowspan="2" pSortableColumn="id">
									<div class="flex items-center gap-2">
										Proyecto
										<p-sortIcon field="price"></p-sortIcon>
									</div>
								</th>
								<th colspan="2" class="text-center">Enero</th>
								<th colspan="2" class="text-center">Febrero</th>
								<th colspan="2" class="text-center">Marzo</th>
								<!-- <th rowspan="2" style="width: 4rem"></th> -->
							</tr>
							<tr>
								<th class="text-center">Cantidad</th>
								<th class="text-center">Valor</th>
								<th class="text-center">Cantidad</th>
								<th class="text-center">Valor</th>
								<th class="text-center">Cantidad</th>
								<th class="text-center">Valor</th>
							</tr>
						</ng-template>
						<ng-template #body let-order>
							<tr>
								<td>{{ order.id }}</td>
								<td>{{ order.enero?.cantidad || 0 }}</td>
								<td>{{ (order.enero?.valor || 0) | currency : 'USD' }}</td>
								<td>{{ order.febrero?.cantidad || 0 }}</td>
								<td>{{ (order.febrero?.valor || 0) | currency : 'USD' }}</td>
								<td>{{ order.marzo?.cantidad || 0 }}</td>
								<td>{{ (order.marzo?.valor || 0) | currency : 'USD' }}</td>
								<!-- <td><p-button type="button" icon="pi pi-search"></p-button></td> -->
							</tr>
						</ng-template>
						<ng-template #emptymessage>
							<tr>
								<td colspan="8">There are no order for this product yet.</td>
							</tr>
						</ng-template>
					</p-table>
				</div>
			</td>
		</tr>
	</ng-template>
</p-table>